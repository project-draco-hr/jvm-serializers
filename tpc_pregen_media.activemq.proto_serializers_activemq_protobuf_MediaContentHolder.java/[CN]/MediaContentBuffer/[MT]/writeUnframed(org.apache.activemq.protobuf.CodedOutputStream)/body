{
  if (buffer == null) {
    int size=serializedSizeUnframed();
    buffer=output.getNextBuffer(size);
    org.apache.activemq.protobuf.CodedOutputStream original=null;
    if (buffer == null) {
      buffer=new org.apache.activemq.util.buffer.Buffer(new byte[size]);
      original=output;
      output=new org.apache.activemq.protobuf.CodedOutputStream(buffer);
    }
    if (bean.hasImage()) {
      for (      Image i : bean.getImageList()) {
        org.apache.activemq.protobuf.MessageBufferSupport.writeMessage(output,1,i.freeze());
      }
    }
    if (bean.hasMedia()) {
      org.apache.activemq.protobuf.MessageBufferSupport.writeMessage(output,2,bean.getMedia().freeze());
    }
    if (original != null) {
      output.checkNoSpaceLeft();
      output=original;
      output.writeRawBytes(buffer);
    }
  }
 else {
    output.writeRawBytes(buffer);
  }
}
